<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="referrer" content="never"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>feign使用教程 | calebzhao的博客</title><meta name="description" content="feign使用教程"><meta name="keywords" content="spring cloud,feign"><meta name="author" content="calebzhao"><meta name="copyright" content="calebzhao"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/calebzhao/cdn/img/20191229155709.png"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="feign使用教程"><meta name="twitter:description" content="feign使用教程"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta property="og:type" content="article"><meta property="og:title" content="feign使用教程"><meta property="og:url" content="https://calebzhao.github.io/2019/12/29/feign%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/"><meta property="og:site_name" content="calebzhao的博客"><meta property="og:description" content="feign使用教程"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://calebzhao.github.io/2019/12/29/feign%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/"><link rel="prev" title="3、Spring Cloud Discovery 源码分析（Eureka）" href="https://calebzhao.github.io/2019/12/29/Spring%20Cloud%20Discovery%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88Eureka%EF%BC%89/"><link rel="next" title="Feign源码学习" href="https://calebzhao.github.io/2019/12/29/Feign%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"EU39VTKAPM","apiKey":"9108b7c9e302dddcc64205e00d26f470","indexName":"hexo","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://calebzhao.github.io/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">calebzhao的博客</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fa fa-picture-o"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">20</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">16</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">5</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fa fa-picture-o"></i><span> 照片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#简介"><span class="toc_mobile_items-text">简介</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#为什么选择Feign而不是其他"><span class="toc_mobile_items-text">为什么选择Feign而不是其他</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Feign工作机制"><span class="toc_mobile_items-text">Feign工作机制</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#基本用法"><span class="toc_mobile_items-text">基本用法</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#注解"><span class="toc_mobile_items-text">注解</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#模板和表达式-Template-And-Expression"><span class="toc_mobile_items-text">模板和表达式(Template And Expression)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#请求参数展开"><span class="toc_mobile_items-text">请求参数展开</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#定制请求参数展开-Expander"><span class="toc_mobile_items-text">定制请求参数展开(Expander)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#请求头-Header-展开"><span class="toc_mobile_items-text">请求头(Header)展开</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#请求体-Body-展开"><span class="toc_mobile_items-text">请求体(Body)展开</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#自定义"><span class="toc_mobile_items-text">自定义</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#多种接口"><span class="toc_mobile_items-text">多种接口</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#示例"><span class="toc_mobile_items-text">示例</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Jackson"><span class="toc_mobile_items-text">Jackson</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Sax"><span class="toc_mobile_items-text">Sax</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#JAXB"><span class="toc_mobile_items-text">JAXB</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#JAX-RS"><span class="toc_mobile_items-text">JAX-RS</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#OkHttp"><span class="toc_mobile_items-text">OkHttp</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Ribbon"><span class="toc_mobile_items-text">Ribbon</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Java-11及-Http2"><span class="toc_mobile_items-text">Java 11及 Http2</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Hystrix"><span class="toc_mobile_items-text">Hystrix</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#SOAP"><span class="toc_mobile_items-text">SOAP</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#SLF4J"><span class="toc_mobile_items-text">SLF4J</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Decoders"><span class="toc_mobile_items-text">Decoders</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Encoders"><span class="toc_mobile_items-text">Encoders</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Body-templates"><span class="toc_mobile_items-text">@Body templates</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Headers"><span class="toc_mobile_items-text">Headers</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#设置动态值的请求头"><span class="toc_mobile_items-text">设置动态值的请求头</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#给Target设置请求头-Target"><span class="toc_mobile_items-text">给Target设置请求头(Target)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#高级用法"><span class="toc_mobile_items-text">高级用法</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Base-APIS"><span class="toc_mobile_items-text">Base APIS</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#继承通用API"><span class="toc_mobile_items-text">继承通用API</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#各种类型有相同的表现形式，定义一个统一的API"><span class="toc_mobile_items-text">各种类型有相同的表现形式，定义一个统一的API</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#日志-Logger"><span class="toc_mobile_items-text">日志(Logger)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#请求拦截器-RequestInterceptor"><span class="toc_mobile_items-text">请求拦截器(RequestInterceptor )</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#自定义-Param-展开"><span class="toc_mobile_items-text">自定义 @Param 展开</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#动态查询参数-QueryMap"><span class="toc_mobile_items-text">动态查询参数(@QueryMap)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#错误处理-Error-Handling"><span class="toc_mobile_items-text">错误处理(Error Handling)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#重试-Retry"><span class="toc_mobile_items-text">重试(Retry)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#静态方法及默认方法（static-method-and-default-method）"><span class="toc_mobile_items-text">静态方法及默认方法（static method and default method）</span></a></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#简介"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#为什么选择Feign而不是其他"><span class="toc-text">为什么选择Feign而不是其他</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Feign工作机制"><span class="toc-text">Feign工作机制</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#基本用法"><span class="toc-text">基本用法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#注解"><span class="toc-text">注解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#模板和表达式-Template-And-Expression"><span class="toc-text">模板和表达式(Template And Expression)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#请求参数展开"><span class="toc-text">请求参数展开</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#定制请求参数展开-Expander"><span class="toc-text">定制请求参数展开(Expander)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#请求头-Header-展开"><span class="toc-text">请求头(Header)展开</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#请求体-Body-展开"><span class="toc-text">请求体(Body)展开</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#自定义"><span class="toc-text">自定义</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#多种接口"><span class="toc-text">多种接口</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#示例"><span class="toc-text">示例</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Jackson"><span class="toc-text">Jackson</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Sax"><span class="toc-text">Sax</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JAXB"><span class="toc-text">JAXB</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JAX-RS"><span class="toc-text">JAX-RS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#OkHttp"><span class="toc-text">OkHttp</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Ribbon"><span class="toc-text">Ribbon</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Java-11及-Http2"><span class="toc-text">Java 11及 Http2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hystrix"><span class="toc-text">Hystrix</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SOAP"><span class="toc-text">SOAP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SLF4J"><span class="toc-text">SLF4J</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Decoders"><span class="toc-text">Decoders</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Encoders"><span class="toc-text">Encoders</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Body-templates"><span class="toc-text">@Body templates</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Headers"><span class="toc-text">Headers</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#设置动态值的请求头"><span class="toc-text">设置动态值的请求头</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#给Target设置请求头-Target"><span class="toc-text">给Target设置请求头(Target)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#高级用法"><span class="toc-text">高级用法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Base-APIS"><span class="toc-text">Base APIS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#继承通用API"><span class="toc-text">继承通用API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#各种类型有相同的表现形式，定义一个统一的API"><span class="toc-text">各种类型有相同的表现形式，定义一个统一的API</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#日志-Logger"><span class="toc-text">日志(Logger)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#请求拦截器-RequestInterceptor"><span class="toc-text">请求拦截器(RequestInterceptor )</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#自定义-Param-展开"><span class="toc-text">自定义 @Param 展开</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#动态查询参数-QueryMap"><span class="toc-text">动态查询参数(@QueryMap)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#错误处理-Error-Handling"><span class="toc-text">错误处理(Error Handling)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#重试-Retry"><span class="toc-text">重试(Retry)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#静态方法及默认方法（static-method-and-default-method）"><span class="toc-text">静态方法及默认方法（static method and default method）</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png)"><div id="post-info"><div id="post-title"><div class="posttitle">feign使用教程</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2019-12-29<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-01-10</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/spring-cloud/">spring cloud</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">2.7k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 10 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>评论数:</span><a href="/2019/12/29/feign%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2019/12/29/feign%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/" itemprop="commentCount"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><html><head></head><body><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Feign是一款java的Restful客户端组件，Feign使得 Java HTTP 客户端编写更方便。Feign 灵感来源于<code>Retrofit</code>, <code>JAXRS-2.0</code>和<code>WebSocket</code>。<code>Feign</code> 最初是为了降低统一绑定Denominator 到 HTTP API 的复杂度，不区分是否支持 ReSTfulness。</p>
<h1 id="为什么选择Feign而不是其他"><a href="#为什么选择Feign而不是其他" class="headerlink" title="为什么选择Feign而不是其他"></a>为什么选择Feign而不是其他</h1><p>你可以使用 <code>Jersey</code> 和 <code>CXF</code> 这些来写一个 Rest 或 SOAP 服务的java客服端。你也可以直接使用 Apache HttpClient 来实现。但是 Feign 的目的是尽量的减少资源和代码来实现和 HTTP API 的连接。通过自定义的编码解码器以及错误处理，你可以编写任何基于文本的 HTTP API。</p>
<h1 id="Feign工作机制"><a href="#Feign工作机制" class="headerlink" title="Feign工作机制"></a>Feign工作机制</h1><p>Feign 通过注解注入一个模板化请求进行工作。只需在发送之前关闭它，参数就可以被直接的运用到模板中。然而这也限制了 Feign，只支持文本形式的API，它在响应请求等方面极大的简化了系统。同时，它也是十分容易进行单元测试的。</p>
<h1 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h1><p>基本的使用如下所示，一个对于canonical Retrofit sample的适配。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">GitHub</span> </span>{</span><br><span class="line">  <span class="meta">@RequestLine</span>(<span class="string">"GET /repos/{owner}/{repo}/contributors"</span>)</span><br><span class="line">  <span class="function">List<contributor> <span class="title">contributors</span><span class="params">(@Param(<span class="string">"owner"</span>)</span> String owner, @<span class="title">Param</span><span class="params">(<span class="string">"repo"</span>)</span> String repo)</contributor></span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestLine</span>(<span class="string">"POST /repos/{owner}/{repo}/issues"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">createIssue</span><span class="params">(Issue issue, @Param(<span class="string">"owner"</span>)</span> String owner, @<span class="title">Param</span><span class="params">(<span class="string">"repo"</span>)</span> String repo)</span>;</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Contributor</span> </span>{</span><br><span class="line">  String login;</span><br><span class="line">  <span class="keyword">int</span> contributions;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Issue</span> </span>{</span><br><span class="line">  String title;</span><br><span class="line">  String body;</span><br><span class="line">  List<string> assignees;</string></span><br><span class="line">  <span class="keyword">int</span> milestone;</span><br><span class="line">  List<string> labels;</string></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> </span>{</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> </span>{</span><br><span class="line">    GitHub github = Feign.builder()</span><br><span class="line">                         .decoder(<span class="keyword">new</span> GsonDecoder())</span><br><span class="line">                         .target(GitHub.class, "https://api.github.com");</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Fetch and print a list of the contributors to this library.</span></span><br><span class="line">    List<contributor> contributors = github.contributors(<span class="string">"OpenFeign"</span>, <span class="string">"feign"</span>);</contributor></span><br><span class="line">    <span class="keyword">for</span> (Contributor contributor : contributors) {</span><br><span class="line">      System.out.println(contributor.login + <span class="string">" ("</span> + contributor.contributions + <span class="string">")"</span>);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h1 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h1><table>
<thead>
<tr>
<th>Annotation</th>
<th>Target</th>
<th>Usage</th>
</tr>
</thead>
<tbody><tr>
<td>@RequestLine</td>
<td>Method</td>
<td>为请求定义HttpMethod 以及UriTemplate，被{expression}包裹的表达式可以通过方法上的@Param注解解析为真实的值</td>
</tr>
<tr>
<td><a href="https://my.oschina.net/u/2303379" target="_blank" rel="noopener">@Param</a></td>
<td>Parameter</td>
<td>定义一个模板变量的值，其值通过用于在解析模板表达式变量时使用，如果该注解在模板表达式中被使用到了，则不会作为form表单提交参数，否则作为表单提交参数</td>
</tr>
<tr>
<td>@Headers</td>
<td>Method， Type</td>
<td>定义HeaderTemplate， 是定义HeaderTemplate的一种变种，使用@Param注解的值来解析@Headers注解中对应的表达式， 当该注解被使用在类上时，该模板将被应用于所有的方法上， 注解被用在方法上时，该模板只会在被该注解标识的方法上生效</td>
</tr>
<tr>
<td>@QueryMap</td>
<td>Parameter</td>
<td>定义了key-value键值对的Map对象或者 POJO，以扩展成查询字符串</td>
</tr>
<tr>
<td>@HeaderMap</td>
<td>Parameter</td>
<td>定义了key-value键值对的Map对象，以扩展到Http Header</td>
</tr>
<tr>
<td>@Body</td>
<td>Method</td>
<td>定义1个模板,该模板类似于UriTemplate 或HeaderTemplate，使用@Params注解的值来解析@Body注解中对应的的表达式</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>重写请求行</strong><br>当Feign被创建时如果需要将一个请求发送到不同的主机，就需要提供它，或者你想为每个请求提供一个目标主机，包含一个 <code>java.net.URI</code>参数，Feign 将使用这个值作为请求目标。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestLine</span>(<span class="string">"POST /repos/{owner}/{repo}/issues"</span>)</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">createIssue</span><span class="params">(URI host, Issue issue, @Param(<span class="string">"owner"</span>)</span> String owner, @<span class="title">Param</span><span class="params">(<span class="string">"repo"</span>)</span> String repo)</span>;</span><br></pre></td></tr></tbody></table></figure></div>
</blockquote>
<h1 id="模板和表达式-Template-And-Expression"><a href="#模板和表达式-Template-And-Expression" class="headerlink" title="模板和表达式(Template And Expression)"></a>模板和表达式(Template And Expression)</h1><p>Feign 表达式由 <a href="https://tools.ietf.org/html/rfc6570" target="_blank" rel="noopener" title="URI 模板 -RFC 6570">URI 模板 -RFC 6570</a>定义的简单字符串表达式(级别1)所表示。 表达式使用其相应的 带有<code>Param</code> 注解的方法参数展开。</p>
<p>例子</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GitHub</span> </span>{</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@RequestLine</span>(<span class="string">"GET /repos/{owner}/{repo}/contributors"</span>)</span><br><span class="line">  <span class="function">List<contributor> <span class="title">contributors</span><span class="params">(@Param(<span class="string">"owner"</span>)</span> String owner, @<span class="title">Param</span><span class="params">(<span class="string">"repo"</span>)</span> String repository)</contributor></span>;</span><br><span class="line">  </span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Contributor</span> </span>{</span><br><span class="line">    String login;</span><br><span class="line">    <span class="keyword">int</span> contributions;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> </span>{</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">    GitHub github = Feign.builder()</span><br><span class="line">                         .decoder(<span class="keyword">new</span> GsonDecoder())</span><br><span class="line">                         .target(GitHub.class, "https://api.github.com");</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* The owner and repository parameters will be used to expand the owner and repo expressions</span></span><br><span class="line"><span class="comment">     * defined in the RequestLine.</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * the resulting uri will be https://api.github.com/repos/OpenFeign/feign/contributors</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    github.contributors(<span class="string">"OpenFeign"</span>, <span class="string">"feign"</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>表达式必须用大括号<code>{}</code>括起来，可以包含正则表达式模式，中间用冒号分隔<code>:</code> 以限制解析值。 示例<code>owner</code>必须按字母顺序排列。 <code>{ owner: [ a-zA-Z ] * }</code></p>
<h1 id="请求参数展开"><a href="#请求参数展开" class="headerlink" title="请求参数展开"></a>请求参数展开</h1><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><figcaption><span>和 ```@QueryMap``` 模板遵循一级模板的[URITemplate-RFC 6570](https://tools.ietf.org/html/rfc6570 "URITemplate-RFC 6570")规范，它指定了以下内容:</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- 省略未解析的表达式</span><br><span class="line">- 如果尚未通过```@Param```注解对所有文字和变量值进行编码或标记为已编码，则所有文字和变量值均经过pct编码。</span><br><span class="line"></span><br><span class="line"># 未定义 vs 空值(Undefined vs Empty)</span><br><span class="line">未定义表达式是指表达式的值为显式```null```或未提供任何值(```""```)的表达式。 根据[URITemplate-RFC 6570](https://tools.ietf.org/html/rfc6570 "URITemplate-RFC 6570")，可以为表达式提供一个空值。当 Feign 解析一个表达式时，它首先确定该值是否已定义，如果已定义，那么将保留该查询参数。 如果未定义，则删除该查询参数。 有关完整的细节，请参见下文。</span><br><span class="line"></span><br><span class="line">- 空字符串(Empty String)</span><br><span class="line">```java</span><br><span class="line">public void test() {</span><br><span class="line">   Map<string, object> parameters = new LinkedHashMap<>();</string,></span><br><span class="line">   parameters.put("param", "");</span><br><span class="line">   this.demoClient.test(parameters);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>结果</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/test?param=</span><br></pre></td></tr></tbody></table></figure></div>
<ul>
<li>没有值(Missing)<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>{</span><br><span class="line">   Map<string, object> parameters = <span class="keyword">new</span> LinkedHashMap<>();</string,></span><br><span class="line">   <span class="keyword">this</span>.demoClient.test(parameters);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
结果<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/test</span><br></pre></td></tr></tbody></table></figure></div></li>
<li>未定义的(Undefined)<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>{</span><br><span class="line">   Map<string, object> parameters = <span class="keyword">new</span> LinkedHashMap<>();</string,></span><br><span class="line">   parameters.put(<span class="string">"param"</span>, <span class="keyword">null</span>);</span><br><span class="line">   <span class="keyword">this</span>.demoClient.test(parameters);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
结果<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/test</span><br></pre></td></tr></tbody></table></figure></div>
更多示例请参见<a href="https://github.com/OpenFeign/feign#advanced-usage" target="_blank" rel="noopener" title="高级用法">高级用法</a>。<blockquote>
<p><strong>斜杠(/)呢?</strong><br>默认情况下,@requestline 和@querymap 模板不编码斜杠 / 字符。 若要更改此行为，请将@requestline 上的 decodeSlash 属性设置为 false。  </p>
<p><strong>加号(+)呢？</strong><br>根据 URI 规范，URI 的路径和查询片段中都允许使用 <code>+</code> 符号，但是查询上的符号处理可能不一致。 在一些遗留系统中，<code>+</code> 等价于一个空格。 Feign 采用了现代系统的方式来处理，在现代系统中，一个 <code>+</code> 符号不应该表示一个空格，当在一个查询字符串中找到<code>+</code>时，它被显式地编码为<code>%2B</code><br>如果您希望使用 <code>+</code> 作为空格，那么可以使用文本字符或直接将值编码为<code>%2B</code> </p>
</blockquote>
</li>
</ul>
<h1 id="定制请求参数展开-Expander"><a href="#定制请求参数展开-Expander" class="headerlink" title="定制请求参数展开(Expander)"></a>定制请求参数展开(Expander)</h1><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><figcaption><span>注解有一个可选的属性扩展器，允许对单个参数的扩展进行完全控制。 ```expander``` 属性必须引用一个```Expander``` 接口的实现类:</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">```java</span><br><span class="line">public interface Expander {</span><br><span class="line">    String expand(Object value);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>此方法的结果遵循上述相的规则。如果结果为 <code>null</code> 或空字符串(<code>""</code>)，则省略该值。 如果值没有经过 pct 编码，那么也会像上面的规则那样做。 更多示例请参见 <a href="https://github.com/OpenFeign/feign#custom-param-expansion" target="_blank" rel="noopener" title="自定义```@Param```扩展">自定义<code>@Param</code>扩展</a>。</p>
<h1 id="请求头-Header-展开"><a href="#请求头-Header-展开" class="headerlink" title="请求头(Header)展开"></a>请求头(Header)展开</h1><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><figcaption><span>和 ```HeaderMap``` 模板遵循与 [请求参数扩展](https://github.com/OpenFeign/feign#request-parameter-expansion "请求参数扩展") 相同的规则，但有以下修改:</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- 省略未解析的表达式。 如果header的结果为空值，则删除整个header</span><br><span class="line">- 未执行 pct 编码</span><br><span class="line"></span><br><span class="line">有关示例，请参阅[Headers](https://github.com/OpenFeign/feign#headers "Headers")。</span><br><span class="line">> #### 关于```@Param``` 参数及其名称的说明: </span><br><span class="line">> 所有名称相同的表达式，不管它们在@requestline、@querymap、@bodytemplate 或@headers 上的位置如何，都将解析为相同的值。 在下面的示例中，contentType 的值将用于解析头部和路径表达式:</span><br><span class="line">> ```java</span><br><span class="line">> public interface ContentService {</span><br><span class="line">> @RequestLine("GET /api/documents/{contentType}")</span><br><span class="line">> @Headers("Accept: {contentType}")</span><br><span class="line">> String getDocumentByType(@Param("contentType") String type);</span><br><span class="line">> }</span><br><span class="line">></span><br></pre></td></tr></tbody></table></figure></div>
<blockquote>
<p>在设计接口时要牢记这一点。</p>
</blockquote>
<h1 id="请求体-Body-展开"><a href="#请求体-Body-展开" class="headerlink" title="请求体(Body)展开"></a>请求体(Body)展开</h1><p>请求体(Body)模板遵循与<a href="https://github.com/OpenFeign/feign#request-parameter-expansion" target="_blank" rel="noopener" title="请求参数">请求参数</a>展开相同的规则，具有以下修改:</p>
<ul>
<li>省略未解析的表达式</li>
<li>展开的值在放到请求正文之前不会通过Encoder 编码器传值</li>
<li>必须指定<code>Content-Type</code>请求头，实例请参阅 <a href="https://github.com/OpenFeign/feign#body-templates" target="_blank" rel="noopener" title="请求体模板">请求体模板</a></li>
</ul>
<h1 id="自定义"><a href="#自定义" class="headerlink" title="自定义"></a>自定义</h1><p>Feign 有许多可以自定义的方面。举个简单的例子，你可以使用 <code>Feign.builder()</code> 来构造一个拥有你自己组件的API接口。如下:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Bank</span> </span>{</span><br><span class="line">  <span class="meta">@RequestLine</span>(<span class="string">"POST /account/{id}"</span>)</span><br><span class="line">  <span class="function">Account <span class="title">getAccountInfo</span><span class="params">(@Param(<span class="string">"id"</span>)</span> String id)</span>;</span><br><span class="line">}</span><br><span class="line">...</span><br><span class="line"><span class="comment">// AccountDecoder 是自己实现的一个Decoder</span></span><br><span class="line">Bank bank = Feign.builder().decoder(new AccountDecoder()).target(Bank.class, "https://api.examplebank.com");</span><br></pre></td></tr></tbody></table></figure></div>

<h1 id="多种接口"><a href="#多种接口" class="headerlink" title="多种接口"></a>多种接口</h1><p>Feign可以提供多种API接口，这些接口都被定义为<code>Target<t></t></code>(默认的实现是 <code>HardCodedTarget<t>)</t></code>, 它允许在执行请求前动态发现和装饰该请求。</p>
<p>举个例子，下面的这个模式允许使用当前url和身份验证token来装饰每个发往身份验证中心服务的请求。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CloudDNS cloudDNS = Feign.builder().target(<span class="keyword">new</span> CloudIdentityTarget<clouddns>(user, apiKey));</clouddns></span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><figcaption><span>包含了[GitHub](https://github.com/OpenFeign/feign/blob/master/example-github "GitHub") 和 [Wikipedia](https://github.com/OpenFeign/feign/blob/master/example-wikipedia "Wikipedia") 客户端的实现样例.相似的项目也同样在实践中运用了Feign。尤其是它的示例后台程序[example daemon](https://github.com/Netflix/denominator/tree/master/example-daemon "example daemon")。</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># Feign集成模块</span><br><span class="line">Feign 可以和其他的开源工具集成工作。你可以将这些开源工具集成到 Feign 中来。目前已经有的一些模块如下:</span><br><span class="line"></span><br><span class="line"># Gson</span><br><span class="line">Gson 包含了一个编码器和一个解码器，这个可以被用于JSON格式的API。</span><br><span class="line">添加 ```GsonEncoder``` 以及 ```GsonDecoder``` 到你的 ```Feign.Builder``` 中， 如下:</span><br><span class="line">```java</span><br><span class="line">GsonCodec codec = new GsonCodec();</span><br><span class="line">GitHub github = Feign.builder()</span><br><span class="line">                     .encoder(new GsonEncoder())</span><br><span class="line">                     .decoder(new GsonDecoder())</span><br><span class="line">                     .target(GitHub.class, "https://api.github.com");</span><br></pre></td></tr></tbody></table></figure></div>

<h1 id="Jackson"><a href="#Jackson" class="headerlink" title="Jackson"></a>Jackson</h1><p>Jackson 包含了一个编码器和一个解码器，这个可以被用于JSON格式的API。<br>添加 <code>JacksonEncoder</code> 以及 <code>JacksonDecoder</code> 到你的 Feign.Builder 中， 如下:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GitHub github = Feign.builder()</span><br><span class="line">                     .encoder(<span class="keyword">new</span> JacksonEncoder())</span><br><span class="line">                     .decoder(<span class="keyword">new</span> JacksonDecoder())</span><br><span class="line">                     .target(GitHub.class, "https://api.github.com");</span><br></pre></td></tr></tbody></table></figure></div>
<p>Maven依赖:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><!-- https://mvnrepository.com/artifact/com.netflix.feign/feign-gson --></span></span><br><span class="line"><span class="tag"><<span class="name">dependency</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">groupId</span>></span>com.netflix.feign<span class="tag"><!--<span class="name"-->groupId</span>></span><br><span class="line">    <span class="tag"><<span class="name">artifactId</span>></span>feign-jackson<span class="tag"><!--<span class="name"-->artifactId</span>></span><br><span class="line">    <span class="tag"><<span class="name">version</span>></span>8.18.0<span class="tag"><!--<span class="name"-->version</span>></span><br><span class="line"><span class="tag"><!--<span class="name"-->dependency</span>></span><br></pre></td></tr></tbody></table></figure></div>

<h1 id="Sax"><a href="#Sax" class="headerlink" title="Sax"></a>Sax</h1><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><figcaption><span>用于解析XML,并兼容普通JVM和Android。下面是一个配置sax来解析响应的例子:</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">```java</span><br><span class="line">api = Feign.builder()</span><br><span class="line">           .decoder(SAXDecoder.builder()</span><br><span class="line">                              .registerContentHandler(UserIdHandler.class)</span><br><span class="line">                              .build())</span><br><span class="line">           .target(Api.class, "https://apihost");</span><br></pre></td></tr></tbody></table></figure></div>
<p>Maven依赖:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag"><<span class="name">dependency</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">groupId</span>></span>com.netflix.feign<span class="tag"><!--<span class="name"-->groupId</span>></span><br><span class="line">    <span class="tag"><<span class="name">artifactId</span>></span>feign-sax<span class="tag"><!--<span class="name"-->artifactId</span>></span><br><span class="line">    <span class="tag"><<span class="name">version</span>></span>8.18.0<span class="tag"><!--<span class="name"-->version</span>></span><br><span class="line"><span class="tag"><!--<span class="name"-->dependency</span>></span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="JAXB"><a href="#JAXB" class="headerlink" title="JAXB"></a>JAXB</h1><p>JAXB 包含了一个编码器和一个解码器，这个可以被用于XML格式的API。<br>添加 <code>JAXBEncoder</code> 以及 <code>JAXBDecoder</code> 到你的 <code>Feign.Builder</code> 中， 如下:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">api = Feign.builder()</span><br><span class="line">           .encoder(<span class="keyword">new</span> JAXBEncoder())</span><br><span class="line">           .decoder(<span class="keyword">new</span> JAXBDecoder())</span><br><span class="line">           .target(Api.class, "https://apihost");</span><br></pre></td></tr></tbody></table></figure></div>
<p>Maven依赖:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><!-- https://mvnrepository.com/artifact/com.netflix.feign/feign-gson --></span></span><br><span class="line"><span class="tag"><<span class="name">dependency</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">groupId</span>></span>com.netflix.feign<span class="tag"><!--<span class="name"-->groupId</span>></span><br><span class="line">    <span class="tag"><<span class="name">artifactId</span>></span>feign-jaxb<span class="tag"><!--<span class="name"-->artifactId</span>></span><br><span class="line">    <span class="tag"><<span class="name">version</span>></span>8.18.0<span class="tag"><!--<span class="name"-->version</span>></span><br><span class="line"><span class="tag"><!--<span class="name"-->dependency</span>></span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="JAX-RS"><a href="#JAX-RS" class="headerlink" title="JAX-RS"></a>JAX-RS</h1><p>JAXRSContract 使用 JAX-RS 规范重写覆盖了默认的注解处理。下面是一个使用 JAX-RS 的例子:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">GitHub</span> </span>{</span><br><span class="line">  [<span class="meta">@GET</span>](https:<span class="comment">//my.oschina.net/get) @Path("/repos/{owner}/{repo}/contributors")</span></span><br><span class="line">  <span class="function">List<contributor> <span class="title">contributors</span><span class="params">(@PathParam(<span class="string">"owner"</span>)</span> String owner, @<span class="title">PathParam</span><span class="params">(<span class="string">"repo"</span>)</span> String repo)</contributor></span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">GitHub github = Feign.builder()</span><br><span class="line">                     .contract(<span class="keyword">new</span> JAXRSContract())</span><br><span class="line">                     .target(GitHub.class, "https://api.github.com");</span><br></pre></td></tr></tbody></table></figure></div>
<p>Maven依赖:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><!-- https://mvnrepository.com/artifact/com.netflix.feign/feign-gson --></span></span><br><span class="line"><span class="tag"><<span class="name">dependency</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">groupId</span>></span>com.netflix.feign<span class="tag"><!--<span class="name"-->groupId</span>></span><br><span class="line">    <span class="tag"><<span class="name">artifactId</span>></span>feign-jaxrs<span class="tag"><!--<span class="name"-->artifactId</span>></span><br><span class="line">    <span class="tag"><<span class="name">version</span>></span>8.18.0<span class="tag"><!--<span class="name"-->version</span>></span><br><span class="line"><span class="tag"><!--<span class="name"-->dependency</span>></span><br></pre></td></tr></tbody></table></figure></div>

<h1 id="OkHttp"><a href="#OkHttp" class="headerlink" title="OkHttp"></a>OkHttp</h1><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><figcaption><span>使用 OkHttp 来发送 Feign 的请求，OkHttp 支持 SPDY (SPDY是Google开发的基于TCP的传输层协议，用以最小化网络延迟，提升网络速度，优化用户的网络使用体验),并有更好的控制http请求。</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">要让 Feign 使用 OkHttp ，你需要将 OkHttp 加入到你的环境变量中区，然后配置 ```Feign``` 使用 ```OkHttpClient```，如下:</span><br><span class="line">```java</span><br><span class="line">GitHub github = Feign.builder()</span><br><span class="line">                     .client(new OkHttpClient())</span><br><span class="line">                     .target(GitHub.class, "https://api.github.com");</span><br></pre></td></tr></tbody></table></figure></div>
<p>Maven依赖:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><!-- https://mvnrepository.com/artifact/com.netflix.feign/feign-gson --></span></span><br><span class="line"><span class="tag"><<span class="name">dependency</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">groupId</span>></span>com.netflix.feign<span class="tag"><!--<span class="name"-->groupId</span>></span><br><span class="line">    <span class="tag"><<span class="name">artifactId</span>></span>feign-okhttp<span class="tag"><!--<span class="name"-->artifactId</span>></span><br><span class="line">    <span class="tag"><<span class="name">version</span>></span>8.18.0<span class="tag"><!--<span class="name"-->version</span>></span><br><span class="line"><span class="tag"><!--<span class="name"-->dependency</span>></span><br></pre></td></tr></tbody></table></figure></div>

<h1 id="Ribbon"><a href="#Ribbon" class="headerlink" title="Ribbon"></a>Ribbon</h1><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><figcaption><span>重写了 Feign 客户端的对URL的处理，其添加了 智能路由以及一些其他由Ribbon提供的弹性功能。</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">集成Ribbon需要你将ribbon的客户端名称当做url的host部分来传递，如下：</span><br></pre></td></tr></tbody></table></figure></div>
<p>// myAppProd是你的ribbon client name<br>MyService api = Feign.builder().client(RibbonClient.create()).target(MyService.class, “<a href="https://myAppProd" " target="_blank" rel="noopener">https://myAppProd"</a>);</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Maven依赖:</span><br><span class="line">```xml</span><br><span class="line"><!-- https://mvnrepository.com/artifact/com.netflix.feign/feign-gson --></span><br><span class="line"><dependency></dependency></span><br><span class="line">    <groupid>com.netflix.feign</groupid></span><br><span class="line">    <artifactid>feign-ribbon</artifactid></span><br><span class="line">    <version>8.18.0</version></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="Java-11及-Http2"><a href="#Java-11及-Http2" class="headerlink" title="Java 11及 Http2"></a>Java 11及 Http2</h1><p>Http2Client 将 Feign 的 http 请求定向到在Java11中新加入的实现了http/2的 <a href="http://www.javamagazine.mozaicreader.com/JulyAug2017#&pageSet=39&page=0" target="_blank" rel="noopener" title="HTTP/2 Client">HTTP/2 Client</a>。</p>
<p>要在Feign中使用新的 HTTP/2客户端，请使用Java SDK 11。 然后配置 Feign 使用 <code>Http2Client</code>:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GitHub github = Feign.builder()</span><br><span class="line">                     .client(<span class="keyword">new</span> Http2Client())</span><br><span class="line">                     .target(GitHub.class, "https://api.github.com");</span><br></pre></td></tr></tbody></table></figure></div>

<h1 id="Hystrix"><a href="#Hystrix" class="headerlink" title="Hystrix"></a>Hystrix</h1><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><figcaption><span>配置了 Hystrix 提供的熔断机制。</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">要在 Feign 中使用 Hystrix ，你需要添加Hystrix模块到你的环境变量，然后使用 ```HystrixFeign``` 来构造你的API:</span><br></pre></td></tr></tbody></table></figure></div>
<p>MyService api = HystrixFeign.builder().target(MyService.class, “<a href="https://myAppProd" " target="_blank" rel="noopener">https://myAppProd"</a>);</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Maven依赖:</span><br><span class="line">```xml</span><br><span class="line"><!-- https://mvnrepository.com/artifact/com.netflix.feign/feign-gson --></span><br><span class="line"><dependency></dependency></span><br><span class="line">    <groupid>com.netflix.feign</groupid></span><br><span class="line">    <artifactid>feign-hystrix</artifactid></span><br><span class="line">    <version>8.18.0</version></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="SOAP"><a href="#SOAP" class="headerlink" title="SOAP"></a>SOAP</h1><p><a href="https://github.com/OpenFeign/feign/blob/master/soap" target="_blank" rel="noopener" title="Soap">SOAP</a> 包含一个编码器和解码器，可以与 XML API 一起使用。</p>
<p>该模块通过 JAXB 和 SOAPMessage 增加了对 SOAP Body 对象的编码和解码支持。 它还通过将 SOAPFault 解码功能包装到原始的 javax.xml.ws.soap.SOAPFaultException 中来提供 SOAPFault 解码功能，因此只需捕获 SOAPFaultException 即可处理 SOAPFault。</p>
<p>向 Feign. Builder 中添加 SOAPEncoder 和 / 或 SOAPDecoder，如下所示:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>{</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">    Api api = Feign.builder()</span><br><span class="line">	     .encoder(<span class="keyword">new</span> SOAPEncoder(jaxbFactory))</span><br><span class="line">	     .decoder(<span class="keyword">new</span> SOAPDecoder(jaxbFactory))</span><br><span class="line">	     .errorDecoder(<span class="keyword">new</span> SOAPErrorDecoder())</span><br><span class="line">	     .target(MyApi.class, "http://api");</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>注意: 如果返回 SOAP 错误，响应了http错误码(4xx，5xx，…)，您可能还需要添加 SOAPErrorDecoder</p>
<h1 id="SLF4J"><a href="#SLF4J" class="headerlink" title="SLF4J"></a>SLF4J</h1><p><a href="https://github.com/OpenFeign/feign/blob/master/slf4j" target="_blank" rel="noopener" title="```SLF4JModule```">SLF4JModule</a> 允许你使用 <a href="http://www.slf4j.org/" target="_blank" rel="noopener" title="SLF4J">SLF4J</a> 作为 Feign 的日志记录模块，这样你就可以轻松的使用 Logback, Log4J , 等来记录你的日志.</p>
<p>要在 Feign 中使用 SLF4J ，你需要添加SLF4J模块和对应的日志记录实现模块(比如Log4J)到你的环境变量，然后配置Feign使用Slf4jLogger :</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GitHub github = Feign.builder()</span><br><span class="line">                     .logger(<span class="keyword">new</span> Slf4jLogger())</span><br><span class="line">                     .target(GitHub.class, "https://api.github.com");</span><br></pre></td></tr></tbody></table></figure></div>
<p>Maven依赖:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">xml</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><!-- https://mvnrepository.com/artifact/com.netflix.feign/feign-gson --></span></span><br><span class="line"><span class="tag"><<span class="name">dependency</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">groupId</span>></span>com.netflix.feign<span class="tag"><!--<span class="name"-->groupId</span>></span><br><span class="line">    <span class="tag"><<span class="name">artifactId</span>></span>feign-slf4j<span class="tag"><!--<span class="name"-->artifactId</span>></span><br><span class="line">    <span class="tag"><<span class="name">version</span>></span>8.18.0<span class="tag"><!--<span class="name"-->version</span>></span><br><span class="line"><span class="tag"><!--<span class="name"-->dependency</span>></span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="Decoders"><a href="#Decoders" class="headerlink" title="Decoders"></a>Decoders</h1><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><figcaption><span>允许你自定义一些额外的配置，比如说如何解码一个响应。假如有接口方法返回的消息不是 Response, String, byte[] 或者 void 类型的，那么你需要配置一个非默认的解码器。</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">下面是一个配置使用JSON解码器(使用的是feign-gson扩展)的例子:</span><br><span class="line">```java</span><br><span class="line">GitHub github = Feign.builder()</span><br><span class="line">                     .decoder(new GsonDecoder())</span><br><span class="line">                     .target(GitHub.class, "https://api.github.com");</span><br></pre></td></tr></tbody></table></figure></div>
<p>假如你想在将响应传递给解码器处理前做一些额外的处理，那么你可以使用 <code>mapAndDecode</code> 方法。一个用例就是使用jsonp服务的时候:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang"></div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JsonpApi jsonpApi = Feign.builder()</span><br><span class="line">                         .mapAndDecode((response, type) -> jsopUnwrap(response, type), <span class="keyword">new</span> GsonDecoder())</span><br><span class="line">                         .target(JsonpApi.class, "https://some-jsonp-api.com");</span><br></pre></td></tr></tbody></table></figure></div>

<h1 id="Encoders"><a href="#Encoders" class="headerlink" title="Encoders"></a>Encoders</h1><p>发送一个Post请求最简单的方法就是传递一个<code>String</code> 或者 <code>byte[]</code> 类型的参数了。你也许还需添加一个<code>Content-Type</code>请求头，如下:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">LoginClient</span> </span>{</span><br><span class="line">  <span class="meta">@RequestLine</span>(<span class="string">"POST /"</span>)</span><br><span class="line">  <span class="meta">@Headers</span>(<span class="string">"Content-Type: application/json"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">login</span><span class="params">(String content)</span></span>;</span><br><span class="line">}</span><br><span class="line">...</span><br><span class="line">client.login(<span class="string">"{\"user_name\": \"denominator\", \"password\": \"secret\"}"</span>);</span><br></pre></td></tr></tbody></table></figure></div>
<p>通过配置一个解码器，你可以发送一个安全类型的请求体，如下是一个使用<code>feign-gson</code> 扩展的例子:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Credentials</span> </span>{</span><br><span class="line">  <span class="keyword">final</span> String user_name;</span><br><span class="line">  <span class="keyword">final</span> String password;</span><br><span class="line"></span><br><span class="line">  Credentials(String user_name, String password) {</span><br><span class="line">    <span class="keyword">this</span>.user_name = user_name;</span><br><span class="line">    <span class="keyword">this</span>.password = password;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">LoginClient</span> </span>{</span><br><span class="line">  <span class="meta">@RequestLine</span>(<span class="string">"POST /"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">login</span><span class="params">(Credentials creds)</span></span>;</span><br><span class="line">}</span><br><span class="line">...</span><br><span class="line">LoginClient client = Feign.builder()</span><br><span class="line">                          .encoder(<span class="keyword">new</span> GsonEncoder())</span><br><span class="line">                          .target(LoginClient.class, "https://foo.com");</span><br><span class="line"></span><br><span class="line">client.login(<span class="keyword">new</span> Credentials(<span class="string">"denominator"</span>, <span class="string">"secret"</span>));</span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="Body-templates"><a href="#Body-templates" class="headerlink" title="@Body templates"></a><a href="https://my.oschina.net/u/3054742" target="_blank" rel="noopener">@Body</a> templates</h1><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><figcaption><span>```@Param``` 注解申明的参数相匹配,使用方法如下</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">```java</span><br><span class="line">interface LoginClient {</span><br><span class="line"></span><br><span class="line">  @RequestLine("POST /")</span><br><span class="line">  @Headers("Content-Type: application/xml")</span><br><span class="line">  @Body("<login \"user_name\"="\"{user_name}\"" \"password\"="\"{password}\"/">")</login></span><br><span class="line">  void xml(@Param("user_name") String user, @Param("password") String password);</span><br><span class="line"></span><br><span class="line">  @RequestLine("POST /")</span><br><span class="line">  @Headers("Content-Type: application/json")</span><br><span class="line">  // json curly braces must be escaped!</span><br><span class="line">  // 这里JSON格式需要的花括号居然需要转码，有点蛋疼了。</span><br><span class="line">  @Body("%7B\"user_name\": \"{user_name}\", \"password\": \"{password}\"%7D")</span><br><span class="line">  void json(@Param("user_name") String user, @Param("password") String password);</span><br><span class="line">}</span><br><span class="line">...</span><br><span class="line">// <login "user_name"="denominator" "password"="secret"></login></span><br><span class="line">client.xml("denominator", "secret");</span><br><span class="line">// {"user_name": "denominator", "password": "secret"}</span><br><span class="line">client.json("denominator", "secret");</span><br></pre></td></tr></tbody></table></figure></div>

<h1 id="Headers"><a href="#Headers" class="headerlink" title="Headers"></a>Headers</h1><p>Feign 支持给请求的api设置或者请求的客户端设置请求头</p>
<p>使用 <code>@Headers</code> 设置静态请求头</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 给BaseApi中的所有方法设置Accept请求头</span><br><span class="line">@Headers("Accept: application/json")</span><br><span class="line">interface BaseApi<v> {</v></span><br><span class="line">  // 单独给put方法设置Content-Type请求头</span><br><span class="line">  @Headers("Content-Type: application/json")</span><br><span class="line">  @RequestLine("PUT /api/{key}")</span><br><span class="line">  void put(@Param("key") String, V value);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="设置动态值的请求头"><a href="#设置动态值的请求头" class="headerlink" title="设置动态值的请求头"></a>设置动态值的请求头</h1><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@RequestLine("POST /")</span><br><span class="line">@Headers("X-Ping: {token}")</span><br><span class="line">void post(@Param("token") String token);</span><br></pre></td></tr></tbody></table></figure></div>
<p>设置key和value都是动态的请求头<br>有些API需要根据调用时动态确定使用不同的请求头(e.g. custom metadata header fields such as “x-amz-meta-” or “x-goog-meta-“),这时候可以使用 <code>@HeaderMap</code>注解，如下:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @HeaderMap 注解设置的请求头优先于其他方式设置的</span></span><br><span class="line"><span class="meta">@RequestLine</span>(<span class="string">"POST /"</span>)</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">post</span><span class="params">(@HeaderMap Map<string, object> headerMap)</string,></span></span>;</span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="给Target设置请求头-Target"><a href="#给Target设置请求头-Target" class="headerlink" title="给Target设置请求头(Target)"></a>给Target设置请求头(Target)</h1><p>有时我们需要在一个API实现中根据不同的endpoint来传入不同的Header，这个时候我们可以使用自定义的<code>RequestInterceptor</code> 或 <code>Target</code>来实现.<br>通过自定义的 <code>RequestInterceptor</code> 来实现请查看 Request Interceptors 章节.<br>下面是一个通过自定义Target来实现给每个Target设置安全校验信息Header的例子:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">static class DynamicAuthTokenTarget<t> implements Target<t> {</t></t></span><br><span class="line">  public DynamicAuthTokenTarget(Class<t> clazz,</t></span><br><span class="line">                                UrlAndTokenProvider provider,</span><br><span class="line">                                ThreadLocal<string> requestIdProvider);</string></span><br><span class="line">  ...</span><br><span class="line">  @Override</span><br><span class="line">  public Request apply(RequestTemplate input) {</span><br><span class="line">    TokenIdAndPublicURL urlAndToken = provider.get();</span><br><span class="line">    if (input.url().indexOf("http") != 0) {</span><br><span class="line">      input.insert(0, urlAndToken.publicURL);</span><br><span class="line">    }</span><br><span class="line">    input.header("X-Auth-Token", urlAndToken.tokenId);</span><br><span class="line">    input.header("X-Request-ID", requestIdProvider.get());</span><br><span class="line"></span><br><span class="line">    return input.request();</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">...</span><br><span class="line">Bank bank = Feign.builder()</span><br><span class="line">        .target(new DynamicAuthTokenTarget(Bank.class, provider, requestIdProvider));</span><br></pre></td></tr></tbody></table></figure></div>
<p>这种方法的实现依赖于给Feign 客户端设置的自定义的<code>RequestInterceptor</code> 或 <code>Target</code>。可以被用来给一个客户端的所有api请求设置请求头。比如说可是被用来在header中设置身份校验信息。这些方法是在线程执行api请求的时候才会执行，所以是允许在运行时根据上下文来动态设置header的。<br>比如说可以根据线程本地存储(thread-local storage)来为不同的线程设置不同的请求头。</p>
<h1 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h1><h2 id="Base-APIS"><a href="#Base-APIS" class="headerlink" title="Base APIS"></a>Base APIS</h2><p>有些请求中的一些方法是通用的，但是可能会有不同的参数类型或者返回类型，这个时候可以这么用:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通用API</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">BaseAPI</span> </span>{</span><br><span class="line">  <span class="meta">@RequestLine</span>(<span class="string">"GET /health"</span>)</span><br><span class="line">  <span class="function">String <span class="title">health</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestLine</span>(<span class="string">"GET /all"</span>)</span><br><span class="line">  <span class="function">List<entity> <span class="title">all</span><span class="params">()</span></entity></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="继承通用API"><a href="#继承通用API" class="headerlink" title="继承通用API"></a>继承通用API</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">CustomAPI</span> <span class="keyword">extends</span> <span class="title">BaseAPI</span> </span>{</span><br><span class="line">  <span class="meta">@RequestLine</span>(<span class="string">"GET /custom"</span>)</span><br><span class="line">  <span class="function">String <span class="title">custom</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="各种类型有相同的表现形式，定义一个统一的API"><a href="#各种类型有相同的表现形式，定义一个统一的API" class="headerlink" title="各种类型有相同的表现形式，定义一个统一的API"></a>各种类型有相同的表现形式，定义一个统一的API</h2><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Headers</span>(<span class="string">"Accept: application/json"</span>)</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">BaseApi</span><<span class="title">V</span>> </span>{</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestLine</span>(<span class="string">"GET /api/{key}"</span>)</span><br><span class="line">  <span class="function">V <span class="title">get</span><span class="params">(@Param(<span class="string">"key"</span>)</span> String key)</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestLine</span>(<span class="string">"GET /api"</span>)</span><br><span class="line">  <span class="function">List<v> <span class="title">list</span><span class="params">()</span></v></span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Headers</span>(<span class="string">"Content-Type: application/json"</span>)</span><br><span class="line">  <span class="meta">@RequestLine</span>(<span class="string">"PUT /api/{key}"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">put</span><span class="params">(@Param(<span class="string">"key"</span>)</span> String key, V value)</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据不同的类型来继承</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">FooApi</span> <span class="keyword">extends</span> <span class="title">BaseApi</span><<span class="title">Foo</span>> </span>{ }</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">BarApi</span> <span class="keyword">extends</span> <span class="title">BaseApi</span><<span class="title">Bar</span>> </span>{ }</span><br></pre></td></tr></tbody></table></figure></div>

<h1 id="日志-Logger"><a href="#日志-Logger" class="headerlink" title="日志(Logger)"></a>日志(Logger)</h1><p>你可以通过设置一个 Logger 来记录http消息，如下:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GitHub github = Feign.builder()</span><br><span class="line">                     .decoder(new GsonDecoder())</span><br><span class="line">                     .logger(new Logger.JavaLogger().appendToFile("logs/http.log"))</span><br><span class="line">                     .logLevel(Logger.Level.FULL)</span><br><span class="line">                     .target(GitHub.class, "https://api.github.com");</span><br></pre></td></tr></tbody></table></figure></div>
<p>也可以参考上面的 SLF4J 章节的说明</p>
<h1 id="请求拦截器-RequestInterceptor"><a href="#请求拦截器-RequestInterceptor" class="headerlink" title="请求拦截器(RequestInterceptor )"></a>请求拦截器(RequestInterceptor )</h1><p>当你希望修改所有的的请求的时候，你可以使用Request Interceptors。比如说，你作为一个中介，你可能需要为每个请求设置 X-Forwarded-For</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">static class ForwardedForInterceptor implements RequestInterceptor {</span><br><span class="line">  @Override public void apply(RequestTemplate template) {</span><br><span class="line">    template.header("X-Forwarded-For", "origin.host.com");</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">public class Example {</span><br><span class="line">  public static void main(String[] args) {</span><br><span class="line">    Bank bank = Feign.builder()</span><br><span class="line">                 .decoder(accountDecoder)</span><br><span class="line">                 .requestInterceptor(new ForwardedForInterceptor())</span><br><span class="line">                 .target(Bank.class, "https://api.examplebank.com");</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>拦截器的另一个常见示例是身份验证，这里有一个内置的基础校验拦截器 BasicAuthRequestInterceptor</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>{</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">    Bank bank = Feign.builder()</span><br><span class="line">                 .decoder(accountDecoder)</span><br><span class="line">                 .requestInterceptor(<span class="keyword">new</span> BasicAuthRequestInterceptor(username, password))</span><br><span class="line">                 .target(Bank.class, "https://api.examplebank.com");</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="自定义-Param-展开"><a href="#自定义-Param-展开" class="headerlink" title="自定义 @Param 展开"></a>自定义 <a href="https://my.oschina.net/u/2303379" target="_blank" rel="noopener">@Param</a> 展开</h1><p>在使用 <code>@Param</code> 注解给模板中的参数设值的时候，默认的是使用的对象的 <code>toString()</code> 方法的值，通过声明 自定义的<code>Param.Expander</code>，用户可以控制其行为，比如说格式化 <code>Date</code> 类型的值:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 通过设置 @Param 的 expander 为 DateToMillis.class 可以定义Date类型的值</span><br><span class="line">@RequestLine("GET /?since={date}")</span><br><span class="line">Result list(@Param(value = "date", expander = DateToMillis.class) Date date);</span><br></pre></td></tr></tbody></table></figure></div>

<h1 id="动态查询参数-QueryMap"><a href="#动态查询参数-QueryMap" class="headerlink" title="动态查询参数(@QueryMap)"></a>动态查询参数(@QueryMap)</h1><p>动态查询参数支持，通过使用 <code>@QueryMap</code> 可以允许动态传入请求参数,如下:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Api</span> </span>{</span><br><span class="line">  <span class="meta">@RequestLine</span>(<span class="string">"GET /find"</span>)</span><br><span class="line">  <span class="function">V <span class="title">find</span><span class="params">(@QueryMap Map<string, object> queryMap)</string,></span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>这也可用于使用 <code>QueryMapEncoder</code> 从 POJO 对象生成查询参数。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Api</span> </span>{</span><br><span class="line">  <span class="meta">@RequestLine</span>(<span class="string">"GET /find"</span>)</span><br><span class="line">  <span class="function">V <span class="title">find</span><span class="params">(@QueryMap CustomPojo customPojo)</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>以这种方式使用时，不需要指定自定义 <code>QueryMapEncoder</code>，就可以使用成员变量名作为查询参数名生成查询映射。 下面的 POJO 将生成<code>" / find?name={name}&number={number}"</code>的查询参数(不保证包含查询参数的顺序，并且通常情况下，如果任何值为 null，都会忽略它)。</p>
<p>设置一个自定义的 <code>QueryMapEncoder</code>:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>{</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">    MyApi myApi = Feign.builder()</span><br><span class="line">                 .queryMapEncoder(<span class="keyword">new</span> MyCustomQueryMapEncoder())</span><br><span class="line">                 .target(MyApi.class, "https://api.hostname.com");</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>当在对象上使用@QueryMap 注解时，默认的编码器会使用反射来检查对象提供的字段，以将对象的值扩展为查询字符串。 如果您希望使用 getter 和 setter 方法构建查询字符串，类似于JavaBean API 中定义的那样，请使用 <code>BeanQueryMapEncoder</code></p>
<h1 id="错误处理-Error-Handling"><a href="#错误处理-Error-Handling" class="headerlink" title="错误处理(Error Handling)"></a>错误处理(Error Handling)</h1><p>如果需要对处理意外响应进行更多控制，那么 Feign 实例可以通过构建器注册自定义的 <code>ErrorDecoder</code>。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>{</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">    MyApi myApi = Feign.builder()</span><br><span class="line">                 .errorDecoder(<span class="keyword">new</span> MyErrorDecoder())</span><br><span class="line">                 .target(MyApi.class, "https://api.hostname.com");</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>所有导致 HTTP 状态不在<code>2xx</code> 范围内的响应都将触发 <code>ErrorDecoder</code> 的 <code>decode</code> 方法，允许您处理响应、将故障包装成自定义异常或执行任何其他处理。 如果要重试请求，请抛出 <code>RetryableException</code>。 这将调用已注册的 <code>Retryer</code>。<br>如果有需要，Feign允许您为每个请求单独维护重试状态，那么每个Client在执行时都将创建一个<code>Retryer</code>实例。</p>
<p>如果重试确定不成功，最后将抛出<code>RetryException</code>。 若要抛出导致重试失败的具体原因，请使用 <code>exceptionPropagationPolicy ()</code>选项来创建您的 Feign 客户端。</p>
<h1 id="重试-Retry"><a href="#重试-Retry" class="headerlink" title="重试(Retry)"></a>重试(Retry)</h1><p>默认情况下，Feign会自动重试<code>IOException</code>，而与HTTP方法无关，将其视为与网络临时相关的异常，以及从<code>ErrorDecoder</code>抛出的任何<code>RetryableException</code>。 要定制此行为，请通过构建器注册定制的Retryer实例。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>{</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">    MyApi myApi = Feign.builder()</span><br><span class="line">                 .retryer(<span class="keyword">new</span> MyRetryer())</span><br><span class="line">                 .target(MyApi.class, "https://api.hostname.com");</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>Retryer 负责根据<code>continueOrPropagate (RetryableException e)</code>方法中返回 的 true 或 false 来确定是否应该进行重试</p>
<h1 id="静态方法及默认方法（static-method-and-default-method）"><a href="#静态方法及默认方法（static-method-and-default-method）" class="headerlink" title="静态方法及默认方法（static method and default method）"></a>静态方法及默认方法（static method and default method）</h1><p>如果你使用的是JDK 1.8+ 的话，那么你可以给接口设置统一的默认方法和静态方法，这是JDK8的新特性，示例如下:</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">GitHub</span> </span>{</span><br><span class="line">  <span class="meta">@RequestLine</span>(<span class="string">"GET /repos/{owner}/{repo}/contributors"</span>)</span><br><span class="line">  <span class="function">List<contributor> <span class="title">contributors</span><span class="params">(@Param(<span class="string">"owner"</span>)</span> String owner, @<span class="title">Param</span><span class="params">(<span class="string">"repo"</span>)</span> String repo)</contributor></span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestLine</span>(<span class="string">"GET /users/{username}/repos?sort={sort}"</span>)</span><br><span class="line">  <span class="function">List<repo> <span class="title">repos</span><span class="params">(@Param(<span class="string">"username"</span>)</span> String owner, @<span class="title">Param</span><span class="params">(<span class="string">"sort"</span>)</span> String sort)</repo></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">default</span> List<repo> <span class="title">repos</span><span class="params">(String owner)</span> </repo></span>{</span><br><span class="line">    <span class="keyword">return</span> repos(owner, <span class="string">"full_name"</span>);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Lists all contributors for all repos owned by a user.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">default</span> List<contributor> <span class="title">contributors</span><span class="params">(String user)</span> </contributor></span>{</span><br><span class="line">    MergingContributorList contributors = <span class="keyword">new</span> MergingContributorList();</span><br><span class="line">    <span class="keyword">for</span>(Repo repo : <span class="keyword">this</span>.repos(owner)) {</span><br><span class="line">      contributors.addAll(<span class="keyword">this</span>.contributors(user, repo.getName()));</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> contributors.mergeResult();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">static</span> GitHub <span class="title">connect</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> Feign.builder()</span><br><span class="line">                .decoder(<span class="keyword">new</span> GsonDecoder())</span><br><span class="line">                .target(GitHub.class, "https://api.github.com");</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>英文原文请参考:<a href="https://github.com/OpenFeign/feign" target="_blank" rel="noopener">https://github.com/OpenFeign/feign</a><br>翻译参考:<a href="https://blog.csdn.net/u010862794/article/details/73649616" target="_blank" rel="noopener">https://blog.csdn.net/u010862794/article/details/73649616</a></p>
</body></html></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">calebzhao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://calebzhao.github.io/2019/12/29/feign%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/">https://calebzhao.github.io/2019/12/29/feign%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://calebzhao.github.io">calebzhao的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/spring-cloud/">spring cloud    </a><a class="post-meta__tags" href="/tags/feign/">feign    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/calebzhao/cdn/img/20191229151714.jpg" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://cdn.jsdelivr.net/gh/calebzhao/cdn/img/20191229152519.jpg" alt="支付宝"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/12/29/Spring%20Cloud%20Discovery%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88Eureka%EF%BC%89/"><img class="prev_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>3、Spring Cloud Discovery 源码分析（Eureka）</span></div></a></div><div class="next-post pull_right"><a href="/2019/12/29/Feign%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>Feign源码学习</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2019/12/29/Feign源码学习/" title="Feign源码学习"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-10</div><div class="relatedPosts_title">Feign源码学习</div></div></a></div><div class="relatedPosts_item"><a href="/2019/12/29/spring-cloud-openfeign源码分析/" title="spring-cloud-openfeign源码分析"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-10</div><div class="relatedPosts_title">spring-cloud-openfeign源码分析</div></div></a></div><div class="relatedPosts_item"><a href="/2020/01/06/spring cloud - bootstrapContext(一)/" title="spring cloud - bootstrapContext(一)"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-10</div><div class="relatedPosts_title">spring cloud - bootstrapContext(一)</div></div></a></div><div class="relatedPosts_item"><a href="/2020/01/02/Spring中的ResolvableType/" title="Spring中的ResolvableType详解."><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-10</div><div class="relatedPosts_title">Spring中的ResolvableType详解.</div></div></a></div><div class="relatedPosts_item"><a href="/2019/12/29/spring.factories自动化配置归类/" title="spring.factories自动化配置归类"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-10</div><div class="relatedPosts_title">spring.factories自动化配置归类</div></div></a></div><div class="relatedPosts_item"><a href="/2019/12/29/2、spring-cloud-ribbon源码分析/" title="2、spring cloud ribbon源码分析"><img class="relatedPosts_cover lazyload"data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-01-10</div><div class="relatedPosts_title">2、spring cloud ribbon源码分析</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = false == true ? true : false;
var verify = false == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = '昵称,邮箱,链接'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'HgchHaGng3F6hbefP0mcTaYh-gzGzoHsz',
  appKey:'j47kWakblNYEeDic8riu7flK',
  placeholder:'请留下你的足迹',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10',
  lang:'zh-cn',
  recordIP: true
});</script></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By calebzhao</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div><img src="https://api.travis-ci.com/calebzhao/calebzhao.github.io.svg?branch=hexo"></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/click_heart.js"></script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>